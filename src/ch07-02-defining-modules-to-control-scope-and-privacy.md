## שימוש במודולים לשליטה על מתחמים ופרטיות

בסעיף זה נעסוק במודולים ובחלקים אחרים של מערכת המודולים, קרי : _מסלולים_ שמאפשרים לנקוב בשמות של פריטים, מילת המפתח `use` המכניסה מסלול למתחם, ומילת המפתח `pub` אשר הופכת פריטים לפומביים. נדון גם במילת המפתח `as`, חבילות חיצוניות, ובאופרטור גלוב.

אך למען נוחות הקריאה, נתחיל עם רשימת כללים שיעזרו לכם לארגן את הקוד העתידי שלכם. נסביר כל אחד מכללים אלה בפירוט.

### שליף למודולים

כאן תמצאו הפניה מהירה למידע שימושי אודות מודולים, מסלולים, מילת המפתח `use` ומילת המפתח `pub`, אופני הפעולה שלהם מול הקומפיילר, וכיצד רוב המפתחים מארגנים את הקוד שלהם. נדגים כל אחד מהכללים האלה במהלך הפרק הזה. זהו מקום מצוין לחזור אליו כל אימת שתרצו להיזכר בדבר עבודה עם מודולים.

- **יש להתחיל בבסיס המכולה**: כאשר מקמפלים מכולה, הקומפיילר ניגש ראשית כל לקובץ בסיס המכולה (בדר"כ _src/lib.rs_ עבור ספריה או _src/main.rs_ עבור מכולה בינארית) ומחפש קוד לקימפול.
- **הכרזה על מודולים**: ניתן להכריז על מודולים חדשים בקובץ בסיס המכולה; נניח שאתם מגדירים את המודול “garden” באמצעות השורה `mod garden;`. הקומפיילר יחפש אחר הקוד של המודול במיקומים הבאים:
  - מקומית בקובץ, בתוך סוגריים מסולסלים במקום הנקודה-פסיק שמופיעה מיד אחרי `mod
garden`
  - בקובץ _src/garden.rs_
  - בקובץ _src/garden/mod.rs_
- **הכרזה על תתי-מודולים**: ניתן להגדיר תתי-מודולים בכל קובץ, זולת בסיס המכולה. כך למשל, ניתן להכריז `mod vegetables;` בקובץ _src/garden.rs_. הקומפיילר יחפש אחר הקוד של תת-המודול בתוך התיקייה ששמה כשם מודול-האב במקומות הבאים:
  - כחלק מהקובץ, מייד לאחר `mod vegetables`, בתוך סוגריים מסולסלים במקום הנקודה-פסיק
  - בקובץ _src/garden/vegetables.rs_
  - בקובץ _src/garden/vegetables/mod.rs_
- **מסלולים לקוד במודולים**: ברגע שמודול מסויים הוא חלק מהמכולה, ניתן לפנות לקוד במודול הזה מכל מקום אחר באותה מכולה תוך ציון מסלול הקוד, במידה וכללי הפרטיות מאפשרים זאת. לדוגמא, אם הטיפוס `Asparagus` נמצא במודול vegetables אשר במודול garden, ניתן לגשת אליו באמצעות `crate::garden::vegetables::Asparagus`.
- **פרטי לעומת פומבי**: קוד הנמצא בתוך מודול, כברירת מחדל, מוגדר כפרטי ביחס למודולי-האב שלו. כדי להפוך מודול לפומבי, יש לבצע את הכרזה מפורשת באמצעות `pub mod` במקום `mod`. כדי להפוך פריטים הנמצאים בתוך מודול פומבי לפומביים אף הם, יש להשתמש ב-`pub` לפני ההכרזות עליהם.
- **מילת המפתח `use`**: במטרה ליתר את השימוש בשמות מסלולים ארוכים, ניתן להשתמש במילת המפתח `use` בכדי לייצר קיצורי דרך לפריטים. בכל מתחם שיכול להפנות ל-`crate::garden::vegetables::Asparagus`, ניתן ליצור קיצור דרך באמצעות `use crate::garden::vegetables::Asparagus;` ומרגע זה, על מנת להשתמש בטיפוס הנדון במתחם, כל שצריך לעשות הוא לכתוב `Asparagus`.

בדוגמא כאן אנו יוצרים מכולה בינארית בשם `backyard` שמדגימה כללים אלה. תיקיית המכולה, שגם היא נקראת `backyard`, מכילה את הקבצים והתיקיות הבאות:

```text
backyard
├── Cargo.lock
├── Cargo.toml
└── src
    ├── garden
    │   └── vegetables.rs
    ├── garden.rs
    └── main.rs
```

קובץ בסיס המכולה במקרה זה הוא _src/main.rs_, ותוכנו הוא:

<span class="filename">Filename: src/main.rs</span>

```rust,noplayground,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/quick-reference-example/src/main.rs}}
```

השורה `pub mod garden;` אומרת לקומפיילר לכלול את הקוד שנמצא בקובץ _src/garden.rs_, שבמקרה זה הוא:

<span class="filename">Filename: src/garden.rs</span>

```rust,noplayground,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/quick-reference-example/src/garden.rs}}
```

כאן, משמעות השורה `pub mod vegetables;`, היא שהקוד בקובץ _src/garden/vegetables.rs_ מוכל אף הוא. קוד זה הוא:

```rust,noplayground,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/quick-reference-example/src/garden/vegetables.rs}}
```

הבה נביט בפרטי הכללים לעיל ונדגים אותם בפעולה!

### איגוד פיסות קוד המקושרות זו לזו לתוך מודולים

_מודולים_ מאפשרים לנו לארגן קוד בתוך מכולה בצורה קריאה ונוחה לשימוש חוזר. מודולים מאפשרים בנוסף לשלוט על פרטיותם של פריטים, כיוון שברירת המחדל היא שקוד הממוקם בתוך מודול הוא פרטי. פריטים פרטיים הם פרטי מימוש פנימיים שאינם זמינים לשימוש חיצוני. ניתן לבחור להפוך מודולים ואת הפריטים שבתוכם לפומביים. הגדרת מודול כפומבי למעשה חושפת אותו לשימוש עבור קוד חיצוני.

כדוגמה, הבה נכתוב מכולת ספריה שמספקת את הפונקציונאליות של מסעדה. אנו נגדיר את חותמי הפונקציות, אבל נשאיר את גופי הפונקציות ריקים על מנת להתרכז בארגון הקוד במקום במימוש המסעדה.

בתעשיית המסעדות, אזורים מסויימים במסעדה נקראים _קדמת הבית_ ואחרים נקראים _אחורי הבית_. אזור קדמת הבית הוא היכן שנמצאים הלקוחות; הוא כולל את אזור ישיבת הלקוחות, את המקומות ללקיחת הזמנות וביצוע תשלומים, והאזורים בהם בריסטות וברמנים מכינים משקאות. אזור אחורי הבית, לעומת זאת, מתייחס למקומות בהם שפים וטבחים עובדים במטבח, שוטפי כלים מנקים, ומנהלים מבצעים עבודה אדמיניסטרטיבית.

על מנת לעצב את המכולה שלנו בצורה זו, אנו יכולים לארגן את הפונקציות לתוך מודולים מקוננים. צרו ספריה חדשה בשם `restaurant` ע"י הרצת `cargo new
restaurant --lib`; ואז הקלידו את הקוד מרשימה 7-1 לתוך הקובץ _src/lib.rs_ כדי להגדיר מספר מודולים וחותמי פונקציות. הנה החלק עבור אזור קדמת הבית:

<span class="filename">Filename: src/lib.rs</span>

```rust,noplayground
{{#rustdoc_include ../listings/ch07-managing-growing-projects/listing-07-01/src/lib.rs}}
```

<span class="caption">רשימה 7-1: מודול עבור `front_of_house` המכיל מודולים אחרים שבעצמם מכילים פונקציות</span>

מגדירים מודול באמצעות מילת המפתח `mod` ולאחריה שם המודול (במקרה זה, `front_of_house`). גוף המודול מוכנס לתוך סוגריים מסולסלים. בתוך מודולים ניתן למקם מודולים אחרים, כמו שמציגה דוגמה זו, עם המודולים `hosting` ו-`serving`. מודולים עשויים גם להכיל הגדרות עבור עצמים אחרים, כמו מבנים, מבחרים, קבועים, תכונות, וגם -- כמו ברשימה 7-1 -- פונקציות.

באמצעות שימוש במודולים, ניתן לאגד יחדיו הגדרות הקשורות זו לזו ולספק שם למהות הקשר. מתכנתים שמשתמשים בקוד יכולים כך לנווט את עצמם תוך התבססות על קבוצות הקוד, במקום להיאלץ לקרוא את כל ההגדרות. כך יותר קל להם למצוא את ההגדרות הרלווניות להם. מתכנתים שמוסיפים פונקציונאליות חדשה לקוד ידעו היכן למקם את הקוד החדש מתוך שאיפה לשמור על הארגון הקיים.

מוקדם יותר הזכרנו שהקבצים _src/main.rs_ ו- _src/lib.rs_ נקראים בסיסי המכולה. הסיבה למינוח זה היא שהתוכן של כל אחד מקבצים אלה יוצרים מכולה שנקראת `crate` בבסיס מבנה המודולים של המכולה, הידוע בשם _עץ המודולים_.

רשימה 7-2 מציגה את עץ המודולים עבור המבנה מרשימה 7-1.

```text
crate
 └── front_of_house
     ├── hosting
     │   ├── add_to_waitlist
     │   └── seat_at_table
     └── serving
         ├── take_order
         ├── serve_order
         └── take_payment
```

<span class="caption">רשימה 7-2: עץ המודולים עבור הקוד מרשימה 7-1</span>

עץ זה מראה כיצד חלק מהמודולים מקוננים אחד בתוך השני; למשל, `hosting` מקונן בתוך `front_of_house`. העץ גם מראה שמודולים מסויימים הם אחים (siblings) אחד של השני, דהיינו שהם מוגדרים באותו מודול; `hosting` ו- `serving` הם מודולים אחים המוגדרים שניהם בתוך `front_of_house`. אם מודול A מוכל בתוך מודל B, אנו אומרים שמודול A הוא _בן_ (child) של מודול B, ושמודול B הוא _אב_ (parent) של מודול A. שימו לב שעץ המודולים כולו מתחיל מהמודול ב-`crate`, שהוא מודול המוגדר באופן מרומז בלבד.

ייתכן שעץ המודולים מזכיר לכם את עץ התיקיות במערכת הקבצים של המחשב שלכם; זוהי השוואה ראויה ביותר! בדיוק כמו תיקיות מערכת הקבצים, מודולים משמשים לארגון קוד. ובדיוק כמו קבצים בתיקייה, אנחנו צריכים דרך פשוטה וקלה למצוא את המודולים להם אנו זקוקים.
